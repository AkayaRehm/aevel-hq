# SOP: Analytics

## Purpose

Compute deterministic aggregations over cleaned data: totals (visits, conversions, revenue) and breakdown by source. All calculations in Python; no LLM involvement.

## Inputs

- **File**: `.tmp/cleaned_data.json` — output of clean_data tool (schema in gemini.md).
- **Environment**: None required for computation.

## Outputs

- **File**: `.tmp/analytics_result.json` — conforming to Analytics Result schema (totals, by_source, period_start/end, summary).
- **Exit**: 0 on success; non-zero if input missing or invalid.

## Edge Cases

- Empty cleaned_data.records: output valid analytics_result with zeros and empty by_source.
- Missing metric keys in a record: treat as 0.
- period_start/period_end derived from min/max timestamp in cleaned records; if no records, use current time.
- summary: optional one-line string generated by tool (e.g. "Total visits: N, revenue: $X"); no LLM.

## Golden Rule

SOP updated before any change to analyze.py behavior.
