{% extends "base_aevel.html" %}
{% block title %}Analytics{% endblock %}
{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
{% endblock %}
{% block content %}
<div class="page-header">
  <h1>Analytics</h1>
  <p class="subtitle">Performance and trends</p>
</div>

<section class="section">
  <h2 class="section-title">Overview</h2>
  <div class="grid grid-3">
    <div class="card">
      <div class="card-title">Data volume</div>
      <div class="card-value" id="analytics-volume">—</div>
      <div class="card-meta">Records processed</div>
    </div>
    <div class="card">
      <div class="card-title">Pipeline status</div>
      <div class="card-value" id="analytics-status" style="font-size: 1rem;">—</div>
      <div class="card-meta">Last run</div>
    </div>
    <div class="card">
      <div class="card-title">Reports generated</div>
      <div class="card-value" id="analytics-reports">—</div>
      <div class="card-meta">This period</div>
    </div>
  </div>
</section>

<section class="section">
  <h2 class="section-title">Trends</h2>
  <div class="card chart-panel">
    <div class="card-title">Performance over time</div>
    <div class="chart-wrapper chart-wrapper--tall">
      <canvas id="chart-performance"></canvas>
    </div>
  </div>
</section>

<section class="section">
  <h2 class="section-title">Breakdown</h2>
  <div class="card">
    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr>
            <th>Source</th>
            <th>Visits</th>
            <th>Conversions</th>
            <th>Revenue</th>
          </tr>
        </thead>
        <tbody id="analytics-tbody">
          <tr><td colspan="4" class="cell-primary">Run a pipeline from Automations to populate analytics.</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
{% endblock %}
{% block scripts %}
<script>
(function() {
  var ctx = document.getElementById('chart-performance');
  if (ctx) {
    new Chart(ctx.getContext('2d'), {
      type: 'bar',
      data: {
        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
        datasets: [{
          label: 'Volume',
          data: [320, 410, 380, 450],
          backgroundColor: 'rgba(209, 213, 219, 0.2)',
          borderColor: '#D1D5DB',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          x: { grid: { color: '#252830' }, ticks: { color: '#6B7280' } },
          y: { grid: { color: '#252830' }, ticks: { color: '#6B7280' } }
        }
      }
    });
  }
  fetch('/health').then(function(r) { return r.json(); }).then(function(d) {
    var el = document.getElementById('analytics-status');
    if (el) el.textContent = d.status === 'ok' ? 'Healthy' : 'Error';
    if (el) el.style.color = d.status === 'ok' ? 'var(--success)' : 'var(--danger)';
  });
  document.getElementById('analytics-volume').textContent = '—';
  document.getElementById('analytics-reports').textContent = '—';
})();
</script>
{% endblock %}
